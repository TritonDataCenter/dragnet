#!/usr/bin/env node

/*
 * crunch: create, query, and destroy indexes on data stored in Manta
 */

var mod_path = require('path');
var VError = require('verror');

var cArg0 = mod_path.basename(process.argv[1]);
var cCmds = {
    'index': cmdIndex,
    'destroy': cmdDestroy,
    'query': cmdQuery
};
var cUsage = [
    'usage: crunch index INDEX_CONFIG_FILE\n',
    '       crunch destroy INDEX_NAME\n',
    '       crunch query INDEX_NAME ...'
].join('');

function usage(err)
{
	if (err)
		console.error('%s: %s', cArg0, err.message);

	console.error(cUsage);
	process.exit(2);
}

function fatal(err)
{
	console.error('%s: %s', cArg0, err.message);
	process.exit(1);
}

function main()
{
	var cmdname, cmdfunc;

	if (process.argv.length < 3)
		usage();

	cmdname = process.argv[2];
	if (!cCmds.hasOwnProperty(cmdname))
		usage(new VError('no such command: "%s"', cmdname));

	cmdfunc = cCmds[cmdname];
	cmdfunc(cmdname, process.argv.slice(3));
}

function cmdIndex(cmdname, argv)
{
	console.log('"%s" not yet implemented', cmdname);
}

function cmdDestroy(cmdname, argv)
{
	console.log('"%s" not yet implemented', cmdname);
}

function cmdQuery(cmdname, argv)
{
	console.log('"%s" not yet implemented', cmdname);
}


main();
